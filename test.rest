
###
# Headerda Postman gibi User-Agent bilgisi olmadan sonuç dönmüyor,.
# Kayıt/Üye olunmadan login olunamaz.
# Login olunmadan da token alınıp bir middleware (/auth gibi) bir api çağrılamaz.
# Önce kayıt ol:
#
# NOT: Aynı kullanıcı defalarca kayıt olamasın diye kodsal değişiklik yapıldı, tabloda da yapılması gerekiyor.
# Login işlemi falan da çalışmıyor çoklu kayıtta, logindeki sorun oymuş sabahtan beri.
# ALTER TABLE users ADD UNIQUE (username);
# ALTER TABLE users ADD UNIQUE (email);
#
###

@hostname = http://localhost/leanphp
@path = api
@userAgent = LeanPHPRestClient
@username = vedat
@password =  vedyweb123
@userEmail = info@vedyweb.com
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjE4LCJuYW1lIjoidmVkYXQiLCJpYXQiOjE3MTQ2MjcyMTQsImV4cCI6MTcxNDYzMDgxNH0.N6IOxOYRzonrgpcBxUhr5SKo_vY8pF_75PIihhzyJL0
###

POST {{hostname}}/register HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}

{
  "username": "{{username}}",
  "password": "{{password}}",
  "email": "{{userEmail}}"
}

###
# Kayıt olduğun veya kayıtlı bir kullanıcıyla login ol:
# Ardından sana 1 saat süresi olan bir token gelecek.
# Kullanıcı bilgilerini içeren o tokenla middleware servislerine erişebilirsin.
###

### Login İsteği
POST {{hostname}}/login HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}

{
  "username": "{{username}}",
  "password": "{{password}}"
}

### Auth ile Kullanıcı Karşılama

###
# Heade alanında loginden aldığın 1 saat geçerli olan tokenla bu servisi çağırmazsan,
# nu hatayı verir: {"error":"Internal Server Error","message":"Invalid or expired token"}
# Her headera bearer token eklemen gerekecek middleware kullanılan metodlar için.
# Bu metod özel, tokenı parce edip user'ı buluyor mesela :)
###
POST {{hostname}}/auth/dashboard HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}
Authorization: Bearer {{token}}

###

GET {{hostname}}/secret HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}
Authorization: Bearer {{token}}

###
# Veritabanı oluşturulmuşsa bu metod başarılı bir şekilde userları ekliyor.
GET {{hostname}}/install HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}
Authorization: Bearer {{token}}

###

GET {{hostname}}/api/users HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}

###

GET {{hostname}}/api/user/3 HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}

###

POST {{hostname}}/api/users HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}
{
    "email": "john.doe@example.com",
    "username": "johndoe",
    "password": "3456777"

}


###
# Buraya maili yazıp post ettiğinde, sana dönen token'a tıklayarak şifreni sıfırlayabiliyorsun.
# Bu şekilde bir yanıt dönüyor: https://localhost/resetPassword/6431bd.....
POST {{hostname}}/newpassword HTTP/1.1
Content-Type: application/json
User-Agent: {{userAgent}}

{
  "email": "info@vedyweb.com"
}

###
# Örnek response 18 - vedyweb{"message":"Token is valid and Password updated successfully"}
# Bundan sonra tekrar login olduğunda yeni şifrenmi giriyorsun.

POST https://localhost/leanphp/resetPassword/5c6f0d36104d72f2098ed19e2f79602cbbe8bf9aba1536f58155c767d172136d08eb622d54bbc7acc3f2f7889c61f67e9a14
Content-Type: application/json
User-Agent: {{userAgent}}

{
  "newPassword": "vedyweb123"
}
